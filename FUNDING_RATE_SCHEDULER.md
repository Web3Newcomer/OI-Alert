# 资金费率调度器说明

## 🎯 功能概述

币安永续合约交易信号系统现在支持按资金费率结算时间自动运行，确保在每次资金费率结算后及时分析市场信号。

## ⏰ 币安资金费率结算时间

币安永续合约资金费率每8小时结算一次：

| UTC时间 | 东八区时间 | 说明 |
|---------|------------|------|
| 00:00 | 08:00 | 上午结算 |
| 08:00 | 16:00 | 下午结算 |
| 16:00 | 00:00 (次日) | 夜间结算 |

## 🚀 使用方法

### 1. 按资金费率结算时间运行
```bash
# 启动守护进程，按资金费率结算时间运行
python scheduler.py --daemon --funding-rate
```

### 2. 查看下次运行时间
```bash
# 查看按资金费率结算时间的下次运行时间
python scheduler.py --show-next --funding-rate
```

### 3. 其他运行模式
```bash
# 立即运行一次
python scheduler.py --run-now

# 每1小时运行一次
python scheduler.py --daemon --every-hours 1

# 每2小时运行一次
python scheduler.py --daemon --every-hours 2

# 每天上午8点运行（默认）
python scheduler.py --daemon
```

## 📊 运行时间示例

假设当前时间是东八区 12:00：

```
下次运行时间: 2025-07-12 16:00:00 (本地时间)
```

这意味着系统将在今天下午4点（UTC 08:00，资金费率结算时间）运行。

## 🔄 完整运行周期

一天内的运行时间：
- **08:00** - 对应UTC 00:00资金费率结算
- **16:00** - 对应UTC 08:00资金费率结算  
- **00:00** - 对应UTC 16:00资金费率结算

## 💡 优势

1. **及时性**：在资金费率结算后立即分析，捕捉最新市场变化
2. **准确性**：基于最新的资金费率数据进行分析
3. **自动化**：无需手动干预，系统自动按结算时间运行
4. **灵活性**：仍支持其他运行模式，满足不同需求

## ⚠️ 注意事项

1. **时区设置**：系统使用东八区时间，确保服务器时区正确
2. **网络稳定**：确保网络连接稳定，避免错过运行时间
3. **资源监控**：定期检查系统资源使用情况
4. **日志查看**：通过 `scheduler.log` 查看运行状态

## 📝 日志示例

```
2025-07-12 12:07:28,173 - INFO - 定时任务已设置：按币安资金费率结算时间运行（东八区 00:00、08:00、16:00）
2025-07-12 12:07:28,173 - INFO - 下次运行时间: 2025-07-12 16:00:00 (本地时间)
```

## 🔧 配置建议

建议在生产环境中使用 `--funding-rate` 模式，因为：

1. **资金费率是重要指标**：结算后的资金费率变化可能预示市场趋势
2. **避免错过机会**：及时分析结算后的市场状况
3. **减少噪音**：避免在非结算时间产生过多信号

## 📞 企业微信通知

系统会在每次运行后通过企业微信发送分析结果，包括：
- 交易信号分析
- 警报信号提醒
- 市场概况总结 